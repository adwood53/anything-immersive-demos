(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{3107:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var r=i(5155),n=i(2115),a=i(8441),o=i.n(a);let l=()=>{let e=(0,n.useRef)(null),t=(0,n.useRef)(null),a=(0,n.useRef)(!1),l=(0,n.useRef)(!0);return(0,n.useEffect)(()=>{let r=document.querySelector("a-camera"),n=r.parentNode,o=async()=>{let[{AlvaAR:a},{Camera:o,resize2cover:c,onFrame:s}]=await Promise.all([i.e(834).then(i.bind(i,7834)),i.e(165).then(i.bind(i,8165))]),d=e.current,h=t.current,u=(await o.Initialize({video:{facingMode:"environment",aspectRatio:16/9,width:{ideal:1280}},audio:!1})).el,f=c(u.videoWidth,u.videoHeight,d.clientWidth,d.clientHeight);h.width=d.clientWidth,h.height=d.clientHeight,u.style.width="".concat(f.width,"px"),u.style.height="".concat(f.height,"px");let w=await a.Initialize(h.width,h.height);document.body.addEventListener("click",()=>w.reset(),!1);let g=h.getContext("2d",{alpha:!1,desynchronized:!0});s(()=>{if(g.clearRect(0,0,h.width,h.height),!document.hidden){g.drawImage(u,0,0,u.videoWidth,u.videoHeight,f.x,f.y,f.width,f.height);let e=g.getImageData(0,0,h.width,h.height),t=w.findCameraPose(e);if(t){!0==l.current&&(n.setAttribute("look-controls","enabled: false"),l.current=!1);let e=n.getAttribute("position"),i=r.getAttribute("quaternion-rotation"),a=new THREE.Vector3(t[12],t[13],t[14]),o=new THREE.Matrix4().fromArray(t),c=new THREE.Quaternion().setFromRotationMatrix(o),s=new THREE.Vector3(e.x,e.y,e.z).lerp(a,.75),d=new THREE.Quaternion(i.x,i.y,i.z,i.w).normalize().slerp(c.normalize(),.75).normalize();n.setAttribute("position",{x:s.x,y:-s.y,z:-s.z}),r.setAttribute("quaternion-rotation",{x:-d.x,y:d.y,z:d.z,w:d.w})}else{if(l){let e=r.getAttribute("quaternion-rotation");n.setAttribute("position","0 0 0"),r.setAttribute("quaternion-rotation",{x:-e.x,y:-e.y,z:-e.z,w:e.w}),n.setAttribute("look-controls","enabled: true"),l.current=!0}for(let e of w.getFramePoints())g.fillStyle="white",g.fillRect(e.x,e.y,2,2)}}return!0},30)};a.current||(o().catch(e=>{console.error("Error initializing SLAM:",e)}),a.current=!0)},[]),(0,r.jsx)("div",{className:"".concat(o().container),ref:e,children:(0,r.jsx)("canvas",{ref:t})})}},8441:e=>{e.exports={container:"DeviceCamera_container__j2VGQ",fadeIn:"DeviceCamera_fadeIn__Cr6HF",splash:"DeviceCamera_splash__bimCV",overlay:"DeviceCamera_overlay__fOsCB"}}}]);