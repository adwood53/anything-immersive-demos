(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{2497:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var r=n(5155),a=n(2115),l=n(2494),i=n.n(l);let o={valueDisplay:{fontSize:"13px",color:"white"}},s=e=>{let{text:t}=e;return(0,r.jsx)("span",{style:o.valueDisplay,children:t})};var u=n(3755),c=n.n(u);let d={container:{gap:"5px",display:"flex",flexDirection:"column"}},f=e=>{let{onValueChanged:t,minValue:n=0,maxValue:l=1,defaultValue:i=.5,step:o=.1,label:u="Label"}=e,[f,g]=(0,a.useState)(i);return(0,r.jsxs)("div",{style:d.container,children:[(0,r.jsx)(s,{text:"".concat(u," ").concat(f)}),(0,r.jsx)("input",{type:"range",min:n,max:l,step:o,value:f,onChange:e=>{let n=e.target.value;g(n),t&&t(n)},className:c().slider})]})},g={container:{alignItems:"left",fontFamily:"Arial, sans-serif"},toggle:{width:"50px",height:"20px",borderRadius:"12px",display:"flex",alignItems:"left",padding:"2.5px",cursor:"pointer",transition:"background-color 0.3s ease",position:"relative"},knob:{width:"15px",height:"15px",backgroundColor:"#fff",borderRadius:"50%",transition:"transform 0.3s ease"}},x=function(e){let{onToggle:t,defaultState:n=!1,activeColor:l="#7466E2",label:i}=e,[o,u]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{u(n)},[n]),(0,r.jsxs)("div",{style:g.container,children:[(0,r.jsx)(s,{text:i}),(0,r.jsx)("div",{style:{...g.toggle,backgroundColor:o?l:"#ccc"},onClick:()=>{let e=!o;u(e),t&&t(e)},children:(0,r.jsx)("div",{style:{...g.knob,transform:o?"translateX(30px)":"translateX(0)"}})})]})},h={button:{padding:"2.5px 15px",backgroundColor:"#E79023",color:"#fff",border:"none",borderRadius:"5px",fontSize:"16px",cursor:"pointer",transition:"background-color 0.3s ease"}},p=function(e){let{onClick:t,label:n="Button",style:a={}}=e;return(0,r.jsx)("button",{style:{...h.button,...a},onClick:t,children:(0,r.jsx)(s,{text:n})})},b=()=>{let[e,t]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),s=(0,a.useRef)(!1),u=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(null);(0,a.useRef)(!0);let g=(0,a.useRef)(new THREE.Vector3(0,0,0)),h=(0,a.useRef)(new THREE.Quaternion(0,0,0,1));(0,a.useRef)(new THREE.Quaternion(0,0,0,1));let b=(0,a.useRef)(null),m=(0,a.useRef)(!0),S=(0,a.useRef)(!0),y=(0,a.useRef)(!0),[w,j]=(0,a.useState)(40),[R,v]=(0,a.useState)(.95),[C,E]=(0,a.useState)(!0),[k,_]=(0,a.useState)(!1),[z,T]=(0,a.useState)(!1),[A,H]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{d.current=document.querySelector("a-camera"),d.current.setAttribute("look-controls","enabled: ".concat(m.current));let e=async()=>{let[{AlvaAR:e},{Camera:t,resize2cover:l,onFrame:i}]=await Promise.all([n.e(834).then(n.bind(n,7834)),n.e(165).then(n.bind(n,8165))]),o=u.current,s=c.current,d=(await t.Initialize({video:{facingMode:"environment",aspectRatio:16/9,width:{ideal:1280}},audio:!1})).el,f=l(d.videoWidth,d.videoHeight,o.clientWidth,o.clientHeight);s.width=o.clientWidth,s.height=o.clientHeight,d.style.width="".concat(f.width,"px"),d.style.height="".concat(f.height,"px");let x=await e.Initialize(s.width,s.height,45,w,R,C,k,A);b.current=x,document.body.addEventListener("click",()=>x.reset(),!1);let p=s.getContext("2d",{alpha:!1,desynchronized:!0});function j(e){for(let t of x.getFramePoints())p.fillStyle=e?"#bdffc0":"#ff7575",p.fillRect(t.x,t.y,2,2)}i(()=>{if(p.clearRect(0,0,s.width,s.height),!document.hidden){p.drawImage(d,0,0,d.videoWidth,d.videoHeight,f.x,f.y,f.width,f.height);let e=p.getImageData(0,0,s.width,s.height),t=x.findCameraPose(e);if(t){let e=new THREE.Vector3(t[12],t[13],t[14]),n=new THREE.Matrix4().fromArray(t),l=new THREE.Quaternion().setFromRotationMatrix(n).normalize();e.y=-e.y,e.z=-e.z,l.x=-l.x,S.current?(g.current=g.current.lerp(e,.5),m.current||(console.log("rot"),h.current=h.current.normalize().slerp(l,.5).normalize())):(g.current=e,m.current||(h.current=l)),r(g.current),m.current||a(h.current),y.current&&j(!0)}else y.current&&j(!1)}return!0},30)};s.current||(s.current=!0,e().then(()=>{t(!0)}).catch(e=>{console.error("Error initializing SLAM:",e)}));let r=e=>{d.current.setAttribute("position",{x:e.x,y:e.y,z:e.z})},a=e=>{d.current.setAttribute("quaternion-rotation",{x:e.x,y:e.y,z:e.z,w:e.w})}},[]),(0,r.jsxs)(r.Fragment,{children:[e&&(0,r.jsxs)("div",{className:"".concat(i().debugContainer),children:[(0,r.jsx)(x,{onToggle:e=>o(e),defaultState:A,activeColor:"#E79023",label:"Show SLAM Controls"}),l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{onToggle:e=>S.current=e,defaultState:S.current,label:"Use Interpolation"}),(0,r.jsx)(x,{onToggle:function(e){m.current=e,null!=d.current&&d.current.setAttribute("look-controls","enabled: ".concat(e))},defaultState:m.current,label:"Use Device Orientation"}),(0,r.jsx)(x,{onToggle:e=>y.current=e,defaultState:y.current,label:"Show Features"}),(0,r.jsx)(f,{onValueChanged:e=>j(e),minValue:10,maxValue:100,defaultValue:w,step:1,label:"Frame Max Cell Size:"}),(0,r.jsx)(f,{onValueChanged:e=>v(e),minValue:0,maxValue:1,defaultValue:R,step:.01,label:"Map Keyframe Filtering Ratio:"}),(0,r.jsx)(x,{onToggle:e=>_(e),defaultState:k,label:"Use CLAHE"}),(0,r.jsx)(x,{onToggle:e=>E(e),defaultState:C,label:"Use P3P"}),(0,r.jsx)(x,{onToggle:e=>T(e),defaultState:A,label:"Use Video Stabilisation"}),(0,r.jsx)(x,{onToggle:e=>H(e),defaultState:A,label:"Show Debug Logs"}),(0,r.jsx)(p,{onClick:function(){b.current.reconfigure(w,R,C,k,z,A)},label:"APPLY"})]})]}),(0,r.jsx)("div",{className:"".concat(i().container),ref:u,children:(0,r.jsx)("canvas",{ref:c})})]})}},3755:e=>{e.exports={slider:"Slider_slider___YTcp"}},2494:e=>{e.exports={container:"SLAMCamera_container__GO4HU",fadeIn:"SLAMCamera_fadeIn__qEfiM",debugContainer:"SLAMCamera_debugContainer__mjp16"}}}]);