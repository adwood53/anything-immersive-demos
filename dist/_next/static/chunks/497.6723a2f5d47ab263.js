(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{2497:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n(5155),a=n(2115),i=n(2494),l=n.n(i);let o={valueDisplay:{fontSize:"13px",color:"white"}},s=e=>{let{text:t}=e;return(0,r.jsx)("span",{style:o.valueDisplay,children:t})};var c=n(3755),u=n.n(c);let d={container:{padding:"10px",gap:"5px",display:"flex",flexDirection:"column"}},h=e=>{let{onValueChanged:t,minValue:n=0,maxValue:i=1,defaultValue:l=.5,step:o=.1,label:c="Label"}=e,[h,x]=(0,a.useState)(l);return(0,r.jsxs)("div",{style:d.container,children:[(0,r.jsx)(s,{text:"".concat(c," ").concat(h)}),(0,r.jsx)("input",{type:"range",min:n,max:i,step:o,value:h,onChange:e=>{let n=e.target.value;x(n),t&&t(n)},className:u().slider})]})},x={container:{alignItems:"left",fontFamily:"Arial, sans-serif",padding:"10px"},toggle:{width:"50px",height:"20px",borderRadius:"12px",display:"flex",alignItems:"left",padding:"2.5px",cursor:"pointer",transition:"background-color 0.3s ease",position:"relative"},knob:{width:"15px",height:"15px",backgroundColor:"#fff",borderRadius:"50%",transition:"transform 0.3s ease"}},f=function(e){let{onToggle:t,defaultState:n=!1,label:i}=e,[l,o]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{o(n)},[n]),(0,r.jsxs)("div",{style:x.container,children:[(0,r.jsx)(s,{text:i}),(0,r.jsx)("div",{style:{...x.toggle,backgroundColor:l?"#7466E2":"#ccc"},onClick:()=>{let e=!l;o(e),t&&t(e)},children:(0,r.jsx)("div",{style:{...x.knob,transform:l?"translateX(30px)":"translateX(0)"}})})]})},g={button:{padding:"10px 20px",backgroundColor:"#E79023",color:"#fff",border:"none",borderRadius:"5px",fontSize:"16px",cursor:"pointer",transition:"background-color 0.3s ease"}},p=function(e){let{onClick:t,label:n="Button",style:a={}}=e;return(0,r.jsx)("button",{style:{...g.button,...a},onClick:t,children:(0,r.jsx)(s,{text:n})})},m=()=>{let e=(0,a.useRef)(!1),[t,i]=(0,a.useState)(!1),o=(0,a.useRef)(null),s=(0,a.useRef)(null),c=(0,a.useRef)(!0),u=(0,a.useRef)(new THREE.Vector3(0,0,0)),d=(0,a.useRef)(new THREE.Quaternion(0,0,0,1)),x=(0,a.useRef)(new THREE.Quaternion(0,0,0,1)),g=(0,a.useRef)(null),m=40,b=.95,y=!1,w=!0,E=!1;return(0,a.useEffect)(()=>{let t=document.querySelector("a-camera"),r=document.getElementById("camera-controls"),a=async()=>{let[{AlvaAR:e},{Camera:t,resize2cover:a,onFrame:i}]=await Promise.all([n.e(834).then(n.bind(n,7834)),n.e(165).then(n.bind(n,8165))]),f=o.current,p=s.current,R=(await t.Initialize({video:{facingMode:"environment",aspectRatio:16/9,width:{ideal:1280}},audio:!1})).el,j=a(R.videoWidth,R.videoHeight,f.clientWidth,f.clientHeight);p.width=f.clientWidth,p.height=f.clientHeight,R.style.width="".concat(j.width,"px"),R.style.height="".concat(j.height,"px");let v=await e.Initialize(p.width,p.height,45,m,b,w,y,E);g.current=v,document.body.addEventListener("click",()=>v.reset(),!1);let C=p.getContext("2d",{alpha:!1,desynchronized:!0});i(()=>{if(C.clearRect(0,0,p.width,p.height),!document.hidden){C.drawImage(R,0,0,R.videoWidth,R.videoHeight,j.x,j.y,j.width,j.height);let e=C.getImageData(0,0,p.width,p.height),t=v.findCameraPose(e),n=r.object3D.quaternion;if(t){!1==c.current&&(r.setAttribute("look-controls","enabled: false"),c.current=!0);let e=new THREE.Vector3(t[12],t[13],t[14]),n=new THREE.Matrix4().fromArray(t),a=new THREE.Quaternion().setFromRotationMatrix(n).normalize();e.y=-e.y,e.z=-e.z,a.x=-a.x,u.current=u.current.lerp(e,.5),d.current=d.current.normalize().slerp(a,.5).normalize(),l(u.current),h(d.current)}else{if(!0==c.current&&(r.setAttribute("look-controls","enabled: true"),c.current=!1),!x.current.equals(n)){x.current.normalize(),n.normalize();let e=new THREE.Quaternion;e.copy(n),e.multiply(x.current.clone().invert()),d.current.multiply(e),d.current.normalize(),h(d.current)}for(let e of v.getFramePoints())C.fillStyle="white",C.fillRect(e.x,e.y,2,2)}x.current.copy(n)}return!0},30)};e.current||(e.current=!0,a().then(()=>{i(!0)}).catch(e=>{console.error("Error initializing SLAM:",e)}));let l=e=>{t.setAttribute("position",{x:e.x,y:e.y,z:e.z})},h=e=>{t.setAttribute("quaternion-rotation",{x:e.x,y:e.y,z:e.z,w:e.w})}},[]),(0,r.jsxs)(r.Fragment,{children:[t&&(0,r.jsxs)("div",{className:"".concat(l().debugContainer),children:[(0,r.jsx)(h,{onValueChanged:e=>{m=e},minValue:10,maxValue:100,defaultValue:m,step:1,label:"Frame Max Cell Size:"}),(0,r.jsx)(h,{onValueChanged:e=>{b=e},minValue:0,maxValue:1,defaultValue:b,step:.01,label:"Map Keyframe Filtering Ratio:"}),(0,r.jsx)(f,{onToggle:e=>{y=e},defaultState:y,label:"Use Clahe"}),(0,r.jsx)(f,{onToggle:e=>{w=e},defaultState:w,label:"Use P3p"}),(0,r.jsx)(f,{onToggle:e=>{E=e},defaultState:E,label:"Debug Logs"}),(0,r.jsx)(p,{onClick:function(){g.current.reconfigure(m,b,w,y,E)},label:"APPLY"})]}),(0,r.jsx)("div",{className:"".concat(l().container),ref:o,children:(0,r.jsx)("canvas",{ref:s})})]})}},3755:e=>{e.exports={slider:"Slider_slider___YTcp"}},2494:e=>{e.exports={container:"SLAMCamera_container__GO4HU",fadeIn:"SLAMCamera_fadeIn__qEfiM",debugContainer:"SLAMCamera_debugContainer__mjp16"}}}]);