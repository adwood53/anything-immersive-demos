(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{3107:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var r=i(5155),n=i(2115),a=i(8441),c=i.n(a);let l=()=>{let e=(0,n.useRef)(null),t=(0,n.useRef)(null),a=(0,n.useRef)(!1),l=(0,n.useRef)(!0),o=(0,n.useRef)({x:0,y:0,z:0});return(0,n.useEffect)(()=>{let r=document.querySelector("a-camera"),n=r.parentNode,c=async()=>{let[{AlvaAR:a},{Camera:c,resize2cover:h,onFrame:s}]=await Promise.all([i.e(834).then(i.bind(i,7834)),i.e(165).then(i.bind(i,8165))]),d=e.current,u=t.current,f=(await c.Initialize({video:{facingMode:"environment",aspectRatio:16/9,width:{ideal:1280}},audio:!1})).el,g=h(f.videoWidth,f.videoHeight,d.clientWidth,d.clientHeight);u.width=d.clientWidth,u.height=d.clientHeight,f.style.width="".concat(g.width,"px"),f.style.height="".concat(g.height,"px");let y=await a.Initialize(u.width,u.height);document.body.addEventListener("click",()=>y.reset(),!1);let x=u.getContext("2d",{alpha:!1,desynchronized:!0});s(()=>{if(x.clearRect(0,0,u.width,u.height),!document.hidden){x.drawImage(f,0,0,f.videoWidth,f.videoHeight,g.x,g.y,g.width,g.height);let e=x.getImageData(0,0,u.width,u.height),t=y.findCameraPose(e);if(t){console.log("have");let e=new THREE.Vector3(t[12],t[13],t[14]);if(!0==l.current){n.setAttribute("position","0 0 0");let e=n.getAttribute("rotation");r.setAttribute("rotation",{x:-e.x,y:-e.y,z:-e.z}),l.current=!1}else{let t={x:e.x-o.current.x,y:e.y-o.current.y,z:e.z-o.current.z},i=n.getAttribute("position");n.setAttribute("position",{x:i.x+t.x,y:i.y-t.y,z:i.z-t.z})}o.current={x:e.x,y:e.y,z:e.z}}else for(let e of(console.log("lost"),l.current=!0,y.getFramePoints()))x.fillStyle="white",x.fillRect(e.x,e.y,2,2)}return!0},30)};a.current||(c().catch(e=>{console.error("Error initializing SLAM:",e)}),a.current=!0)},[]),(0,r.jsx)("div",{className:"".concat(c().container),ref:e,children:(0,r.jsx)("canvas",{ref:t})})}},8441:e=>{e.exports={container:"DeviceCamera_container__j2VGQ",fadeIn:"DeviceCamera_fadeIn__Cr6HF",splash:"DeviceCamera_splash__bimCV",overlay:"DeviceCamera_overlay__fOsCB"}}}]);