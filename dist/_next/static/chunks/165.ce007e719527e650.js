"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[165],{8165:(e,t,i)=>{i.r(t),i.d(t,{Camera:()=>l,Video:()=>u,deg2rad:()=>r,getScreenOrientation:()=>h,isIOS:()=>o,isMobile:()=>s,onFrame:()=>n,rad2deg:()=>a,resize2cover:()=>c});let a=180/Math.PI,r=Math.PI/180;function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,i=~~(1e3/t),a=performance.now(),r=async()=>{let t=performance.now(),n=t-a;n>i&&(a=t-n%i,await e(t)===!1)||requestAnimationFrame(r)};requestAnimationFrame(r)}function o(){return/iPad|iPhone|iPod/.test(navigator.platform)}function s(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}function h(){let e=-1;switch(window.screen&&window.screen.orientation?e=window.screen.orientation.angle:"orientation"in window&&(e=window.orientation),e){case 0:case 180:return"portrait";case 90:return"landscape_left";case 270:case -90:return"landscape_right"}return"unknown"}function c(e,t,i,a){let r={};if(i/a>e/t){let n=i/e;r.width=~~(n*e),r.height=~~(n*t),r.x=0,r.y=~~((a-r.height)*.5)}else{let n=a/t;r.width=~~(n*e),r.height=~~(n*t),r.x=~~((i-r.width)*.5),r.y=0}return r}function d(e,t){let i=document.createElement("canvas");return i.width=e,i.height=t,i}class l{static async Initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if("facingMode"in e&&"deviceId"in e)throw Error("Camera settings 'deviceId' and 'facingMode' are mutually exclusive.");if("facingMode"in e&&-1===["environment","user"].indexOf(e.facingMode))throw Error("Camera settings 'facingMode' can only be 'environment' or 'user'.");let t=t=>new Promise((i,a)=>{if(t&&"denied"===t.state){a(Error("Failed to access camera: Permission denied."));return}navigator.mediaDevices.getUserMedia(e).then(e=>{let t=e.getVideoTracks()[0];if(void 0===t)a(Error("Failed to access camera: Permission denied (No track)."));else{let a=document.createElement("video");a.setAttribute("autoplay","autoplay"),a.setAttribute("playsinline","playsinline"),a.setAttribute("webkit-playsinline","webkit-playsinline"),a.srcObject=e,a.onloadedmetadata=()=>{let e=t.getSettings(),r=e.width,n=e.height,o=a.videoWidth,s=a.videoHeight;(o!==r||s!==n)&&console.warn("Video dimensions mismatch: width: ".concat(r,"/").concat(o,", height: ").concat(n,"/").concat(s)),a.style.width=o+"px",a.style.height=s+"px",a.width=o,a.height=s,a.play(),i(new l(a))}}}).catch(e=>{switch(e.name){case"NotFoundError":case"DevicesNotFoundError":a(Error("Failed to access camera: Camera not found."));return;case"SourceUnavailableError":a(Error("Failed to access camera: Camera busy."));return;case"PermissionDeniedError":case"SecurityError":a(Error("Failed to access camera: Permission denied."));return;default:a(Error("Failed to access camera: Rejected."));return}})});return navigator.permissions&&navigator.permissions.query?navigator.permissions.query({name:"camera"}).then(e=>t(e)).catch(e=>t()):t()}getImageData(){return this._ctx.clearRect(0,0,this.width,this.height),this._ctx.drawImage(this.el,0,0,this.width,this.height),this._ctx.getImageData(0,0,this.width,this.height)}constructor(e){this.el=e,this.width=e.videoWidth,this.height=e.videoHeight,this._canvas=d(this.width,this.height),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0})}}class u{static async Initialize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8e3;return new Promise((i,a)=>{let r=-1,n=document.createElement("video");n.src=e,n.setAttribute("autoplay","autoplay"),n.setAttribute("playsinline","playsinline"),n.setAttribute("webkit-playsinline","webkit-playsinline"),n.autoplay=!0,n.muted=!0,n.loop=!0,n.load(),r=setTimeout(()=>{a(Error("Failed to load video: Timed out after ".concat(t,"ms.")))},t),n.onerror=()=>{clearTimeout(r),a(Error("Failed to load video."))},n.onabort=()=>{clearTimeout(r),a(Error("Failed to load video: Load aborted."))},n.readyState>=4?(clearTimeout(r),i(n)):n.oncanplaythrough=()=>{clearTimeout(r),0===n.videoWidth||0===n.videoHeight?a(Error("Failed to load video: Invalid dimensions.")):i(n)}}).then(e=>(e.onload=e.onabort=e.onerror=null,new u(e)))}getImageData(){let e=this.el.currentTime;return this._lastTime!==e&&(this._lastTime=e,this._imageData=null),null===this._imageData&&(this._ctx.clearRect(0,0,this.width,this.height),this._ctx.drawImage(this.el,0,0,this.width,this.height),this._imageData=this._ctx.getImageData(0,0,this.width,this.height)),this._imageData}constructor(e){this.el=e,this.width=e.videoWidth,this.height=e.videoHeight,this._canvas=d(this.width,this.height),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0}),this._lastTime=-1,this._imageData=null}}}}]);