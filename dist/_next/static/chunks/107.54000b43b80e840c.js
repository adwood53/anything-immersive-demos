(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{3107:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(5155),i=r(2115),a=r(8441),c=r.n(a);let l=()=>{let e=(0,i.useRef)(!1),t=(0,i.useRef)(null),a=(0,i.useRef)(null),l=(0,i.useRef)(!0),o=(0,i.useRef)(new THREE.Vector3(0,0,0)),u=(0,i.useRef)(new THREE.Quaternion(0,0,0,1)),s=(0,i.useRef)(new THREE.Vector3(0,0,0));return(0,i.useEffect)(()=>{let n=document.querySelector("a-camera"),i=document.getElementById("camera-controls"),c=async()=>{let[{AlvaAR:e},{Camera:n,resize2cover:c,onFrame:E}]=await Promise.all([r.e(834).then(r.bind(r,7834)),r.e(165).then(r.bind(r,8165))]),f=t.current,m=a.current,w=(await n.Initialize({video:{facingMode:"environment",aspectRatio:16/9,width:{ideal:1280}},audio:!1})).el,y=c(w.videoWidth,w.videoHeight,f.clientWidth,f.clientHeight);m.width=f.clientWidth,m.height=f.clientHeight,w.style.width="".concat(y.width,"px"),w.style.height="".concat(y.height,"px");let R=await e.Initialize(m.width,m.height);document.body.addEventListener("click",()=>R.reset(),!1);let g=m.getContext("2d",{alpha:!1,desynchronized:!0});E(()=>{if(g.clearRect(0,0,m.width,m.height),!document.hidden){g.drawImage(w,0,0,w.videoWidth,w.videoHeight,y.x,y.y,y.width,y.height);let e=g.getImageData(0,0,m.width,m.height),t=R.findCameraPose(e),r=i.getAttribute("rotation");if(t){!1==l.current&&(i.setAttribute("look-controls","enabled: false"),l.current=!0);let e=new THREE.Vector3(t[12],t[13],t[14]),r=new THREE.Matrix4().fromArray(t),n=new THREE.Quaternion().setFromRotationMatrix(r).normalize();e.y=-e.y,e.z=-e.z,n.x=-n.x,o.current=o.current.lerp(e,.5),u.current=u.current.normalize().slerp(n,.5).normalize(),d(o.current),h(u.current)}else{!0==l.current&&(i.setAttribute("look-controls","enabled: true"),l.current=!1);let e=new THREE.Vector3(r.x-s.current.x,r.y-s.current.y,r.z-s.current.z).clone().multiplyScalar(THREE.MathUtils.DEG2RAD),t=new THREE.Euler(e.x,e.y,e.z,"YXZ"),n=new THREE.Quaternion;for(let e of(n.setFromEuler(t),u.current.multiply(n),u.current.z=0,h(u.current),R.getFramePoints()))g.fillStyle="white",g.fillRect(e.x,e.y,2,2)}s.current=new THREE.Vector3(r.x,r.y,r.z)}return!0},30)};e.current||(c().catch(e=>{console.error("Error initializing SLAM:",e)}),e.current=!0);let d=e=>{n.setAttribute("position",{x:e.x,y:e.y,z:e.z})},h=e=>{n.setAttribute("quaternion-rotation",{x:e.x,y:e.y,z:e.z,w:e.w})}},[]),(0,n.jsx)("div",{className:"".concat(c().container),ref:t,children:(0,n.jsx)("canvas",{ref:a})})}},8441:e=>{e.exports={container:"DeviceCamera_container__j2VGQ",fadeIn:"DeviceCamera_fadeIn__Cr6HF",splash:"DeviceCamera_splash__bimCV",overlay:"DeviceCamera_overlay__fOsCB"}}}]);