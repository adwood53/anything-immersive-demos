(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{3107:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var i=r(5155),n=r(2115),a=r(8441),o=r.n(a);let c=()=>{let e=(0,n.useRef)(null),t=(0,n.useRef)(null),a=(0,n.useRef)(!1),c=(0,n.useRef)(!0),l=(0,n.useRef)(new THREE.Vector3(0,0,0)),u=(0,n.useRef)(new THREE.Quaternion(0,0,0,1));return(0,n.useEffect)(()=>{let i=document.querySelector("a-camera"),n=i.parentNode,o=async()=>{let[{AlvaAR:a},{Camera:o,resize2cover:s,onFrame:d}]=await Promise.all([r.e(834).then(r.bind(r,7834)),r.e(165).then(r.bind(r,8165))]),h=e.current,f=t.current,w=(await o.Initialize({video:{facingMode:"environment",aspectRatio:16/9,width:{ideal:1280}},audio:!1})).el,m=s(w.videoWidth,w.videoHeight,h.clientWidth,h.clientHeight);f.width=h.clientWidth,f.height=h.clientHeight,w.style.width="".concat(m.width,"px"),w.style.height="".concat(m.height,"px");let y=await a.Initialize(f.width,f.height);document.body.addEventListener("click",()=>y.reset(),!1);let E=f.getContext("2d",{alpha:!1,desynchronized:!0});d(()=>{if(E.clearRect(0,0,f.width,f.height),!document.hidden){E.drawImage(w,0,0,w.videoWidth,w.videoHeight,m.x,m.y,m.width,m.height);let e=E.getImageData(0,0,f.width,f.height),t=y.findCameraPose(e);if(t){!1==c.current&&(n.setAttribute("look-controls","enabled: false"),n.setAttribute("rotation","0 0 0"),c.current=!0);let e=new THREE.Vector3(t[12],t[13],t[14]),r=new THREE.Matrix4().fromArray(t),a=new THREE.Quaternion().setFromRotationMatrix(r).normalize(),o=new THREE.Vector3(l.current.x,l.current.y,l.current.z),s=new THREE.Quaternion(u.current.x,u.current.y,u.current.z,u.current.w).normalize(),d=o.lerp(e,.5),h=s.slerp(a,.5).normalize();n.setAttribute("position",{x:d.x,y:-d.y,z:-d.z}),i.setAttribute("quaternion-rotation",{x:-h.x,y:h.y,z:h.z,w:h.w}),l.current=d,u.current=h}else for(let e of(!0==c.current&&(u.current={x:0,y:0,z:0,w:1},i.setAttribute("quaternion-rotation",u.current),n.setAttribute("look-controls","enabled: true"),c.current=!1),y.getFramePoints()))E.fillStyle="white",E.fillRect(e.x,e.y,2,2)}return!0},30)};a.current||(o().catch(e=>{console.error("Error initializing SLAM:",e)}),a.current=!0)},[]),(0,i.jsx)("div",{className:"".concat(o().container),ref:e,children:(0,i.jsx)("canvas",{ref:t})})}},8441:e=>{e.exports={container:"DeviceCamera_container__j2VGQ",fadeIn:"DeviceCamera_fadeIn__Cr6HF",splash:"DeviceCamera_splash__bimCV",overlay:"DeviceCamera_overlay__fOsCB"}}}]);