(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{3107:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var i=r(5155),n=r(2115),a=r(8441),o=r.n(a);let l=()=>{let e=(0,n.useRef)(!1),t=(0,n.useRef)(null),a=(0,n.useRef)(null),l=(0,n.useRef)(!0),c=(0,n.useRef)(new THREE.Vector3(0,0,0)),u=(0,n.useRef)(new THREE.Quaternion(0,0,0,1)),d=(0,n.useRef)(new THREE.Vector3(0,0,0));return(0,n.useEffect)(()=>{let i=document.querySelector("a-camera"),n=document.getElementById("camera-controls"),o=async()=>{let[{AlvaAR:e},{Camera:o,resize2cover:E,onFrame:w}]=await Promise.all([r.e(834).then(r.bind(r,7834)),r.e(165).then(r.bind(r,8165))]),f=t.current,m=a.current,y=(await o.Initialize({video:{facingMode:"environment",aspectRatio:16/9,width:{ideal:1280}},audio:!1})).el,R=E(y.videoWidth,y.videoHeight,f.clientWidth,f.clientHeight);m.width=f.clientWidth,m.height=f.clientHeight,y.style.width="".concat(R.width,"px"),y.style.height="".concat(R.height,"px");let g=await e.Initialize(m.width,m.height);document.body.addEventListener("click",()=>g.reset(),!1);let x=m.getContext("2d",{alpha:!1,desynchronized:!0});w(()=>{if(x.clearRect(0,0,m.width,m.height),!document.hidden){x.drawImage(y,0,0,y.videoWidth,y.videoHeight,R.x,R.y,R.width,R.height);let e=x.getImageData(0,0,m.width,m.height),t=g.findCameraPose(e);if(t){!1==l.current&&(n.setAttribute("look-controls","enabled: false"),l.current=!0);let e=new THREE.Vector3(t[12],t[13],t[14]),r=new THREE.Matrix4().fromArray(t),i=new THREE.Quaternion().setFromRotationMatrix(r).normalize(),a=c.current.lerp(e,.5),o=u.current.normalize().slerp(i,.5).normalize();s({x:a.x,y:-a.y,z:-a.z}),h({x:-o.x,y:o.y,z:o.z,w:o.w}),c.current=a,u.current=o}else{!0==l.current&&(n.setAttribute("look-controls","enabled: true"),l.current=!1);let e=n.getAttribute("rotation"),t={x:e.x-d.current.x,y:e.y-d.current.y,z:e.z-d.current.z},r=new THREE.Vector3(THREE.MathUtils.degToRad(t.x),THREE.MathUtils.degToRad(t.y),THREE.MathUtils.degToRad(t.z)),a=new THREE.Euler(r.x,r.y,r.z,"YXZ"),o=new THREE.Quaternion;for(let e of(o.setFromEuler(a),u.current.premultiply(o).normalize(),h(i,u),g.getFramePoints()))x.fillStyle="white",x.fillRect(e.x,e.y,2,2)}d.current=n.getAttribute("rotation")}return!0},30)};e.current||(o().catch(e=>{console.error("Error initializing SLAM:",e)}),e.current=!0);let s=e=>{i.setAttribute("position",{x:e.x,y:e.y,z:e.z})},h=e=>{i.setAttribute("quaternion-rotation",{x:e.x,y:e.y,z:e.z,w:e.w})}},[]),(0,i.jsx)("div",{className:"".concat(o().container),ref:t,children:(0,i.jsx)("canvas",{ref:a})})}},8441:e=>{e.exports={container:"DeviceCamera_container__j2VGQ",fadeIn:"DeviceCamera_fadeIn__Cr6HF",splash:"DeviceCamera_splash__bimCV",overlay:"DeviceCamera_overlay__fOsCB"}}}]);